{% extends 'Proyectos/_common/base_proyectos.html' %}
{% load static %}
<title>{% block titulo %}Editar Contrato{% endblock %}</title>
{% block styles %}
<!-- DEMO related CSS below -->
	<link rel="stylesheet" media="screen, print" href="{%static 'EVA/Plantilla/css/fa-brands.css' %}">
	<!-- page related CSS below -->
	<link rel="stylesheet" media="screen, print" href="{% static 'EVA/Plantilla/css/formplugins/select2/select2.bundle.css' %}">
    <link rel="stylesheet" media="screen, print" href="{% static 'EVA/Plantilla/css/notifications/toastr/toastr.css' %}">
    <link rel="stylesheet" media="screen, print" href="{% static 'EVA/Plantilla/css/fa-regular.css' %}">
    <link rel="stylesheet" media="screen, print" href="{% static 'EVA/Plantilla/css/formplugins/bootstrap-datepicker/bootstrap-datepicker.css' %}">
{% endblock %}

{% block main %}

<div class="panel-container show">
    <div class="header">
         <h1 class="header-title">
            <i class='far fa-file-alt'></i> Contratos: <span class='fw-300'>Editar</span>
             <br>
             <br>
         </h1>
    </div>
    <div class="row">
        <div class="col-xl-12">
            <div id="panel-1" class="panel">
                <div class="panel-container show">
                    <div class="panel-content">
                        <div class="panel-group">
                            <div class="panel-body">
                                {% if error %}
                                    <div class="alert alert-danger alert-dismissible fade show">
                                        <strong>{{ error }}</strong>
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                {% endif %}
                                <form action="{% url 'Proyectos:contratos-editar' contrato.id %}" id="tercero" method="post">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <div class="form-row">
                                             <div class="col-md-6">
                                                <label for="cliente_select">Cliente</label>
                                                <select class="select2 form-control w-100 select2-selection--single" id="cliente_select" name="cliente_id" required oninvalid="this.setCustomValidity('Por favor seleccione una opción de la lista')" oninput="this.setCustomValidity('')">
                                                    <option value="" >Seleccione un Tipo de Cliente</option>
                                                    {% for tercero in terceros %}
                                                        {% if tercero.tipo_tercero.nombre.lower == 'cliente' %}
                                                        <option value="{{ tercero.id }}" {% if tercero.id == contrato.cliente.id %} selected {% endif %}>{{ tercero.nombre }}</option>
                                                        {% endif %}
                                                    {% endfor %}
                                                </select>
                                              </div>
                                            <div class="col-md-6">
                                                <label for="contrato_numero">Número de contrato</label>
                                                <input class="form-control" id="contrato_numero" type="text" name="numero_contrato" oninvalid="this.setCustomValidity('Por favor ingrese un número de contrato')" oninput="setCustomValidity('')" placeholder="Ingrese el número del contrato" required maxlength="20" value="{{ contrato.numero_contrato }}">
                                            </div>
                                            <div class="col-md-6">
                                                <br>
                                                <label for="rango_anho_select">Año</label>
                                                <select class="select2 form-control w-100 select2-selection--single" type="number" id="rango_anho_select" name="rango_anho" required oninvalid="this.setCustomValidity('Por favor seleccione una opción de la lista')" oninput="this.setCustomValidity('')">
                                                    <option value="" >Seleccione un año</option>
                                                    {% for anho in rango_anho %}
                                                        <option value="{{ anho }}" {% if anho == contrato.anho %}selected{% endif %}>{{ anho }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                 <br>
                                                <label for="contrato_supervisor_nombre">Nombre del supervisor</label>
                                                <input class="form-control" id="contrato_supervisor_nombre" type="text" oninvalid="this.setCustomValidity('Por favor ingrese el nombre del supervisor')" oninput="setCustomValidity('')" name="supervisor_nombre" placeholder="Ingrese el nombre del supervisor" required maxlength="100" value="{{ contrato.supervisor_nombre }}">
                                            </div>
                                            <div class="col-md-6">
                                                <br>
                                                <label for="contrato_telefono_supervisor">Teléfono del supervisor</label>
                                                <input class="form-control" id="contrato_telefono_supervisor" type="text" name="supervisor_telefono" placeholder="Ingrese el número telefónico del supervisor" required maxlength="20" value="{{ contrato.supervisor_telefono }}">
                                            </div>
                                            <div class="col-md-6">
                                                <br>
                                                <label for="contrato_correo_supervisor">Correo electrónico del supervisor</label>
                                                <input class="form-control" id="contrato_correo_supervisor" type="email" name="supervisor_correo" placeholder="Ingrese el correo electrónico del supervisor" maxlength="100" value="{{ contrato.supervisor_correo }}">
                                            </div>
                                            <div class="col-md-6">
                                                 <br>
                                                <label for="contrato_residente">Nombre del residente</label>
                                                <input class="form-control" id="contrato_residente" type="text" name="residente" oninvalid="this.setCustomValidity('Por favor ingrese el nombre del residente')" oninput="setCustomValidity('')" placeholder="Ingrese el nombre del residente" required maxlength="100" value="{{ contrato.residente }}">
                                            </div>
                                             <div class="col-md-6">
                                                 <br>
                                                <label for="fecha_inicio">Fecha de inicio</label>
                                                <input class="form-control" id="fecha_inicio" name="fecha_inicio" oninvalid="this.setCustomValidity('Por favor seleccione una fecha')" oninput="setCustomValidity('')" placeholder="Seleccione una fecha"  autocomplete="off" value="{{ contrato.fecha_inicio | date:'Y-m-d' }}" required>
                                            </div>
                                             <div class="col-md-6">
                                                 <br>
                                                <label for="fecha_terminacion">Fecha de terminación</label>
                                                <input class="form-control" id="fecha_terminacion" name="fecha_terminacion" oninvalid="this.setCustomValidity('Por favor seleccione una fecha')" oninput="setCustomValidity('')" placeholder="Seleccione una fecha"  autocomplete="off" value="{{ contrato.fecha_terminacion | date:'Y-m-d' }}" required>
                                            </div>
                                            <div class="col-md-6">
                                                <br>
                                                <label for="contrato_valor">Valor</label>
                                                <input class="form-control" id="contrato_valor" type="number" name="valor" oninvalid="this.setCustomValidity('Por favor ingrese el valor')" oninput="setCustomValidity('')" placeholder="Ingrese el valor del contrato" required min="0" max="9999999999" value="{{ contrato.valor }}">
                                            </div>
                                            <div class="col-md-6">
                                                <br>
                                                <label for="contrato_periocidad_informes">Periocidad de informes</label>
                                                <input class="form-control" id="contrato_periocidad_informes" type="text" oninvalid="this.setCustomValidity('Por favor ingrese un valor')" oninput="setCustomValidity('')" name="periocidad_informes" placeholder="Ingrese la periocidad de los informes" required maxlength="20" value="{{ contrato.periocidad_informes }}">
                                            </div>
                                            <div class="col-md-6">
                                                <br>
                                                <label for="contrato_tiempo">Tiempo</label>
                                                <input class="form-control" id="contrato_tiempo" type="text" name="tiempo" oninvalid="this.setCustomValidity('Por favor ingrese un valor')" oninput="setCustomValidity('')" placeholder="Ingrese el tiempo" required maxlength="20" value="{{ contrato.tiempo }}">
                                            </div>
                                            <div class="col-md-6">
                                                <br>
                                                <label for="tipo_contrato_select">Tipo de contrato</label>
                                                <select class="select2 form-control w-100 select2-selection--single" id="tipo_contrato_select" name="tipo_contrato_id" required oninvalid="this.setCustomValidity('Por favor seleccione una opción de la lista')" oninput="this.setCustomValidity('')">
                                                    <option value="" >Seleccione un Tipo de Contrato</option>
                                                    {% for tipo_contrato in tipo_contratos %}
                                                        <option value="{{ tipo_contrato.id }}" {% if tipo_contrato.id == contrato.tipo_contrato_id %} selected {% endif %}>{{ tipo_contrato.nombre }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <br>
                                                <label for="empresa_select">Empresa</label>
                                                <select class="select2 form-control w-100 select2-selection--single" id="empresa_select" name="empresa_id" required oninvalid="this.setCustomValidity('Por favor seleccione una opción de la lista')" oninput="this.setCustomValidity('')">
                                                    <option value="" >Seleccione una Empresa</option>
                                                    {% for empresa in empresas %}
                                                        <option value="{{ empresa.id }}" {% if empresa.id == contrato.empresa_id %} selected {% endif %}>{{ empresa.nombre }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div>
                                            <button id="agregar" class="btn btn-primary btn-block">Actualizar</button>
                                        </div>
                                        <div style="padding-left: 15px">
                                            <a href="{% url 'Proyectos:contratos' %}" class="btn btn-danger btn-block">Cancelar</a>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}

<script src="{% static 'EVA/Plantilla/js/jquery-ui.min.js' %}"></script>
<script src="{% static 'EVA/Plantilla/js/formplugins/select2/select2.bundle.js' %}"></script>
<script src="{% static 'Administracion/js/select_divipol.js' %}"></script>
<script src="{% static 'EVA/Plantilla/js/vendors.bundle.js'%}"></script>
<script src="{% static 'EVA/Plantilla/js/app.bundle.js' %}"></script>
<script src="{% static 'EVA/Plantilla/js/formplugins/select2/select2.bundle.js' %}"></script>
<script src="{% static 'EVA/Plantilla/js/notifications/toastr/toastr.js' %}"></script>
<script src="{% static 'EVA/Plantilla/js/formplugins/bootstrap-datepicker/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'Proyectos/js/Contratos/date_picker.js' %}"></script>
    <script>
		$(document).ready(function () {
			$(function() {
				$('.select2').select2();

				$(".select2-placeholder-multiple").select2({
					placeholder: "Select State"
				});
				$(".js-hide-search").select2({
					minimumResultsForSearch: 1 / 0
				});
				$(".js-max-length").select2({
					maximumSelectionLength: 2,
					placeholder: "Select maximum 2 items"
				});
				$(".select2-placeholder").select2({
					placeholder:"Select a state",
					allowClear: true
				});

				$(".js-select2-icons").select2({
					minimumResultsForSearch: 1 / 0,
					templateResult: icon,
					templateSelection: icon,
					escapeMarkup: function (elm) {
						return elm
					}
				});
				function icon(elm) {
					elm.element;
					return elm.id ? "<i class='" + $(elm.element).data("icon") + " mr-2'></i>" + elm.text : elm.text
				}

				$(".js-data-example-ajax").select2({
				  ajax: {
				    url: "https://api.github.com/search/repositories",
				    dataType: 'json',
				    delay: 250,
				    data: function (params) {
				      return {
				        q: params.term, // search term
				        page: params.page
				      };
				    },
				    processResults: function (data, params) {
				      // parse the results into the format expected by Select2
				      // since we are using custom formatting functions we do not need to
				      // alter the remote JSON data, except to indicate that infinite
				      // scrolling can be used
				      params.page = params.page || 1;

				      return {
				        results: data.items,
				        pagination: {
				          more: (params.page * 30) < data.total_count
				        }
				      };
				    },
				    cache: true
				  },
				  placeholder: 'Search for a repository',
				  escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
				  minimumInputLength: 1,
				  templateResult: formatRepo,
				  templateSelection: formatRepoSelection
				});

				function formatRepo (repo) {
				  if (repo.loading) {
				    return repo.text;
				  }

				  var markup = "<div class='select2-result-repository clearfix d-flex'>" +
				    "<div class='select2-result-repository__avatar mr-2'><img src='" + repo.owner.avatar_url + "' class='width-2 height-2 mt-1 rounded' /></div>" +
				    "<div class='select2-result-repository__meta'>" +
				      "<div class='select2-result-repository__title fs-lg fw-500'>" + repo.full_name + "</div>";

				  if (repo.description) {
				    markup += "<div class='select2-result-repository__description fs-xs opacity-80 mb-1'>" + repo.description + "</div>";
				  }

				  markup += "<div class='select2-result-repository__statistics d-flex fs-sm'>" +
				    "<div class='select2-result-repository__forks mr-2'><i class='fal fa-lightbulb'></i> " + repo.forks_count + " Forks</div>" +
				    "<div class='select2-result-repository__stargazers mr-2'><i class='fal fa-star'></i> " + repo.stargazers_count + " Stars</div>" +
				    "<div class='select2-result-repository__watchers mr-2'><i class='fal fa-eye'></i> " + repo.watchers_count + " Watchers</div>" +
				  "</div>" +
				  "</div></div>";

				  return markup;
				}

				function formatRepoSelection (repo) {
				  return repo.full_name || repo.text;
				}
			});
		});
	</script>


{% endblock %}